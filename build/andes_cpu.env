#!/bin/bash

# !!!!NOT WORKING YET. I could not find Tensoflow C++ API (header files and libraries) in Andes.
# MGM (05/11/2022)

module load gcc python

export CC=gcc
export CXX=g++
export CXXFLAGS="-I${TF_INCLUDE_DIR}"
export TFFLAGS="-L${TF_LIBRARY_DIR} -ltensorflow"

# For Andes
export TF_DIR=/sw/andes/python/3.7/anaconda-base/lib/python3.7/site-packages/tensorflow_core
export TF_INCLUDE_DIR=$TF_DIR/include
# The above include directory doesnot have the required header files in `tensorflow/c/`. could not find them in other locations.
export TF_LIBRARY_DIR=$TF_DIR

# ==============Make sure TF_*_DIR are defined. Sample for Summit:==============
# echo $TF_INCLUDE_DIR 
# /sw/summit/open-ce/anaconda-base/envs/open-ce-1.1.3-py38-0/lib/python3.8/site-packages/tensorflow/include
# echo $TF_LIBRARY_DIR 
# /sw/summit/open-ce/anaconda-base/envs/open-ce-1.1.3-py38-0/lib/python3.8/site-packages/tensorflow

# ==============Compile and run:==============
# Pass the tensorflow flags: gcc example_tensorflowNN_cpu.cpp -I$TF_INCLUDE_DIR -L$TF_LIBRARY_DIR -ltensorflow -o test
# Run the following after `source <machine_name>.env`:
# cd ..
# make
# ./example.exe
